<div
  class="sprint-conteiner"
  id="{{ currentSprint.id }}"
  cdkDropList
  #doneList="cdkDropList"
  [cdkDropListData]="currentSprint.tasks"
  (cdkDropListDropped)="drop($event)"
>
  <details
    [open]="currentSprint.startAt && !currentSprint.isComplete ? true : false"
  >
    <summary>
      <div class="wrapper">
        <div class="marker">
          <p class="open">
            <fa-icon
              [icon]="faChevronRight"
              class="rotatable"
              id="dropdown-arrow-icon"
            ></fa-icon>
          </p>
          <p class="close">
            <fa-icon
              [icon]="faAngleDown"
              class="rotatable"
              id="dropdown-arrow-icon"
            ></fa-icon>
          </p>
        </div>
        <h4 class="sprint-name">{{ currentSprint.name }}</h4>
        <div class="sprint-date">
          <p class="startAt">
            {{ currentSprint.startAt | date: 'mediumDate' }}
          </p>
          <p *ngIf="currentSprint.startAt">-</p>
          <p *ngIf="!currentSprint.startAt && currentSprint.endAt">deadline:</p>
          <p class="endAt">{{ currentSprint.endAt | date: 'mediumDate' }}</p>
        </div>
        <div class="issues">
          <p>issues</p>
          <p class="issues-count">
            {{ tasks && tasks.length ? tasks.length : 0 }}
          </p>
        </div>
        <div class="estimate">
          <p>estimate</p>
          <p class="estimate-count">{{ estimate }}</p>
        </div>
        <div class="wrapper button">
          <app-edit-sprint
            *ngIf="
              !currentSprint.startAt &&
              sprintIndex == 0 &&
              isCurrentUserAdmin &&
              !currentSprint.isComplete
            "
            [currentSprint]="currentSprint"
            class="btn mini voilet full start-sprint"
            [isStarting]="true"
          ></app-edit-sprint>

          <app-complete-sprint
            *ngIf="
              currentSprint.startAt &&
              isCurrentUserAdmin &&
              !currentSprint.isComplete
            "
            [sprint]="currentSprint"
            class="btn complete-sprint"
            completeBthClass="btn mini violet-fill full"
            completeBtnText="Complete sprint"
          ></app-complete-sprint>

          <div
            class="dropdown-button"
            *ngIf="isCurrentUserAdmin && !currentSprint.isComplete"
          >
            <div class="dropdown" style="float: right">
              <tasque-button
                class="btn dropbtn"
                [icon]="faEllipsisV"
              ></tasque-button>
              <div class="dropdown-content">
                <a
                  *ngIf="
                    sprintIndex != 0 &&
                    (sprintIndex != 1 || !sprints[0].startAt)
                  "
                >
                  <tasque-button
                    (click)="$sprintUp(currentSprint)"
                    text="Move sprint up"
                    class="btn full black"
                  ></tasque-button>
                </a>
                <a *ngIf="sprintIndex != 0 || !currentSprint.startAt">
                  <tasque-button
                    (click)="$sprintDown(currentSprint)"
                    text="Move sprint down"
                    class="btn full black"
                  ></tasque-button>
                </a>
                <a>
                  <app-edit-sprint
                    [currentSprint]="currentSprint"
                    btnClass="btn full black"
                  ></app-edit-sprint>
                </a>
                <a>
                  <tasque-button
                    text="Delete sprint"
                    class="btn full black"
                  ></tasque-button>
                </a>
              </div>
            </div>
          </div>
          <div class="completed" *ngIf="currentSprint.isComplete">
            completed
          </div>
        </div>
      </div>
    </summary>
    <div class="sprint-header">
      <div class="select-user">
        <tasque-team-select
          [avatars]="sprintUsers"
          (selectedUser)="filterUserTasks($event)"
          *ngIf="sprintUsersCircle && sprintUsers.length > 0"
        ></tasque-team-select>
      </div>
    </div>
    <div class="sprint-body">
      <div class="empty-tasks row pale" *ngIf="tasks && tasks.length === 0">
        <label class="text-center"
          >Plan a sprint by dragging the sprint footer down below some issue, or
          by dragging issue here</label
        >
      </div>

      <app-issue
        *ngFor="let task of tasks"
        [issue]="task"
        [taskStates]="taskState"
        [taskTypes]="taskType"
        [currentUser]="currentUser"
        (estimate)="estimateCount()"
        [currentProject]="currentProject"
      ></app-issue>
    </div>
    <div class="sprint-footer">
      <tasque-task-creation
        *ngIf="!currentSprint.isComplete"
        btnText="+ Create issues"
        btnClass="btn mini voilet"
        [sidebarName]="createIssueSidebarName"
        [organizationId]="currentProject.organizationId"
        [currentProject]="currentProject"
      ></tasque-task-creation>
    </div>
  </details>
</div>
